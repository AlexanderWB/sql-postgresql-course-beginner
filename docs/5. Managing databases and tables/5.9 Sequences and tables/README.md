# Sequences. Последовательности и таблицы

```sql
DROP TABLE IF EXISTS book

CREATE TABLE book
(
    book_id int NOT NULL, -- Сейчас у нас book_id - это просто int без автоинкремента
    -- book_id serial NOT NULL, -- Можно было бы указать как serial
    title text NOT NULL,
    isbn varchar(32) NOT NULL,
    publisher_id int NOT NULL,
    
    CONSTRAINT PK_book_book_id PRIMARY KEY(book_id)
);
```

```sql
SELECT * FROM book;
```

Установим `SEQUENCE` для колонки `book_id`
```sql
-- Разберем как сделать serial тип из обычного ont
CREATE SEQUENCE IF NOT EXISTS book_book_id_seq -- Создаем SEQUENCE
START WITH 1 OWNED BY book.book_id -- Начинается с 1, назначить на данную колонку
```

Также надо повесить `DEFAULT` CONSTRAINT на эту колонку
```sql
ALTER TABLE book
ALTER COLUMN book_id SET DEFAULT nextval('book_book_id_seq')
```

Проверим автоинкремент
```sql
INSERT INTO book(title, isbn, publisher_id)
VALUES('title', 'isbn', 1)
```

Именно так работает псевдотип `serial`

Рассмотрим более продвинутый подход, синтаксис:
```sql
CREATE TABLE book
(
    book_id int GENERATED ALWAYS AS IDENTITY NOT NULL, -- Запрещает вставлять данные в колонку явно
    -- book_id int GENERATED BY DEFAULT AS IDENTITY NOT NULL, -- Будет вести себя как serial
    title text NOT NULL,
    isbn varchar(32) NOT NULL,
    publisher_id int NOT NULL,
    
    CONSTRAINT PK_book_book_id PRIMARY KEY(book_id)
)
```
