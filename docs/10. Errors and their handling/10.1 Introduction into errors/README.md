# Введение в ошибки, обработку ошибок

- Иногда в коде случаются ошибки
- Что делать если в функцию пришёл некорректный параметр?
- Необходимо прекратить выполнение функции и подать сигнал наверх о проблемах
- Для этого используются исключения (EXCEPTIONS)
- Только в PL/pgSQL функциях

### Синтаксис
- `RAISE [level] 'message (%)', arg_name;`
- `level` - уровень "серьезности" ошибки:
  - `DEBUG` - отладка
  - `LOG` - лог
  - `INFO` - информация
  - `NOTICE` - замечание
  - `WARNING` - потенциальная опасность
  - `EXCEPTION` - исключение / ошибка
- `EXCEPTION` - абортирует текущую транзакцию
- `log_min_messages` - регулирует уровень сообщений, которые будут писаться в лог сервера (`WARNING` - по умолчанию)
- `client_min_messages` - регулирует уровень сообщений, которые будут передаваться вызывающей стороне (`NOTICE` - по умолчанию)
- Из самых важных параметров можно упомянуть `HINT` и `ERRCODE`
- Параметры присоединяются с помощью `USING`:
```sql
RAISE 'invalid billing number=%', number USING HINT='Check out the billing number' ERRCODE='12881'
```

### Обработка ошибок

- Чтобы "поймать" исключение нужен блок `EXCEPTION WHEN`:
```sql
EXCEPTION WHEN condition [others] THEN handling_logic
```
- Код в блоке `EXCEPTION` теряет в производительности
- Старайтесь по возможности избегать исключений
