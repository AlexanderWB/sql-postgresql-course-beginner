# Методы сканирования

## Немного об индексах

Устанавливает соответствие между ключом и строками таблицы, в которых этот ключ встречается.

- Индекс — объект БД, который можно создать и удалить
- Позволяет искать значения без полного перебора
- Также индексы называют "методами доступа"
- Оптимизация выборки "небольшого" числа записей
  - От того, сколько записей фильтрует запрос — зависит будет ли использован индекс или полное сканирование таблицы
  - Что за небольшое число "небольшое" число — число относительное кол-ва записей.
- По `PRIMARY KEY` и `UNIQUE` столбцам индекс создаётся автоматически.
- Индексы не бесплатны
  - При любой операции (INSERT, UPDATE, DELETE), индексы должны быть перестроены в рамках той же транзакции
    
```sql
SELECT amname FROM pg_am; -- Какие типы индексов доступны на сервере
```

- B-tree (сбалансированное дерево)
- Хеш-индекс
- GiST (обобщённое дерево поиска)
- GIN (обобщённый обратный)
- SP-GiST (GiST с двоичным разбиением пространства)
- BRIN (блочно-диапазонный)

## Какими методами происходит сканирование

Оптимизатор решает, какие методы поиска включать

- Индексное (index scan)
  - Если попадает в результирующий набор **малое количество строк**
- Исключительно индексное сканирование (index only scan)
  - Забирает результат прямо из индекса
  - Заглядывает в visibility map
- Сканирование по битовой карте (bitmap scan)
  - Версии строк читаются из таблицы
  - Работает при поиске больше чем по одному индексу
  - Когда мы обновляем или удаляем строки — они не исчезают сразу, PostgreSQL трекает и отслеживает версии строк
- Последовательное сканирование (sequential scan)
